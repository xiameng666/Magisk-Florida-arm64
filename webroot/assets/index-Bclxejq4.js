!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();let e=0;function t(t,r){return void 0===r&&(r={}),new Promise((n,s)=>{const o=`${"exec"}_callback_${Date.now()}_${e++}`;function a(e){delete window[e]}window[o]=(e,t,r)=>{n({errno:e,stdout:t,stderr:r}),a(o)};try{ksu.exec(t,JSON.stringify(r),o)}catch(i){s(i),a(o)}})}function r(e){ksu.toast(e)}const n=document.getElementById("serverStatus"),s=document.getElementById("serverStatusText"),o=document.getElementById("toggleServerBtn"),a=document.getElementById("saveSettingsBtn"),i=document.getElementById("portInput"),c=document.getElementById("customParams"),l=document.getElementById("warningDialog"),d=document.getElementById("cancelStop"),u=document.getElementById("confirmStop");let g=!1;const m="/data/adb/modules/magisk-hluda/module.cfg";async function f(){try{const e=g?1:0,r=`port=${i.value}\nparameters=${c.value}\nstatus=${e}`;await t(`echo '${r}' > ${m}`),console.log("Created module.cfg with default values")}catch(e){console.error("Error creating module.cfg:",e),r("Failed to initialize config file")}}async function p(){try{const e=parseInt(i.value);(isNaN(e)||e<1||e>65535)&&(r("Invalid port number. Using default port 27042"),i.value="27042");const{errno:n}=await t(`test -f ${m}`);if(0!==n)return void(await f());await t(`sed -i "s/^port=.*/port=${i.value}/" ${m}`);const s=c.value.replace(/\//g,"\\/").replace(/'/g,"\\'").replace(/"/g,'\\"');await t(`sed -i "s/^parameters=.*/parameters=${s}/" ${m}`);const o=g?1:0;await t(`sed -i "s/^status=.*/status=${o}/" ${m}`),r("Settings saved successfully")}catch(e){console.error("Failed to save settings:",e),r(`Failed to save settings: ${e.message}`)}}function y(e){g!==e&&(g=e,n.classList.toggle("status-running",e),n.classList.toggle("status-stopped",!e),s.textContent=e?"Running":"Stopped",o.textContent=e?"Stop Server":"Start Server",o.classList.toggle("btn-danger",e),o.classList.toggle("btn-primary",!e),async function(e){const r=e?"Running ✅":"Stopped ❌";try{await t(`sed -i "s/^description=.*/description=[${r}]/" /data/adb/modules/magisk-hluda/module.prop`)}catch(n){console.error("Failed to update module.prop:",n)}}(e))}async function v(){try{const{errno:e}=await t("pgrep -f florida");y(0===e)}catch(e){console.error("Error checking server status:",e),y(!1)}}a.addEventListener("click",p),o.addEventListener("click",async()=>{const e=i.value||"27042",n=c.value;g?l.style.display="flex":(await p(),await async function(e,n){const s=`florida -D -l 0.0.0.0:${e}`,o=n?`${s} ${n}`:s;try{const{errno:e,stderr:n}=await t(o);if(0!==e||n.trim())return r(`Failed to start server: ${n.trim()||"Unknown error occurred"}`),void y(!1);setTimeout(v,500),r("Server started successfully")}catch(a){r(`Failed to start server: ${a.message}`),y(!1)}}(e,n))}),d.addEventListener("click",()=>{l.style.display="none"}),u.addEventListener("click",async()=>{l.style.display="none",await p(),await async function(){try{const{errno:e}=await t("pkill -SIGKILL -f florida");if(0!==e)throw new Error("Server not running");y(!1),r("Server stopped successfully")}catch(e){r(`Failed to stop server: ${e.message}`)}}()}),async function(){try{const{errno:e}=await t(`test -f ${m}`);if(0!==e)return void(await f());const{stdout:r}=await t(`grep "^port=" ${m} | cut -d= -f2`),{stdout:n}=await t(`grep "^parameters=" ${m} | cut -d= -f2-`);i.value=r.trim()||"27042",c.value=n.trim()||""}catch(e){console.error("Failed to load settings:",e),r(`Failed to load settings: ${e.message}`)}}().then(()=>{v(),setInterval(v,500)});
